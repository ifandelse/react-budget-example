!function(e,t,s){t.configuration.promise.createDeferred=function(){return new s.Deferred},t.configuration.promise.getPromise=function(e){return e.promise()};var a={requestData:function(){var e=this;t.channel(e.props.namespace).request({topic:"read",data:{id:this.props.id},timeout:this.props.timeout||2e3}).then(function(t){e.setState(t)})}},i={componentDidMount:function(){this.subscriptions={}},publish:function(e,s){t.publish({channel:this.props.namespace,topic:e,data:s})},subscribe:function(e,s){this.subscriptions[e]||(this.subscriptions[e]=t.subscribe({channel:this.props.namespace,topic:e,callback:s}).withContext(this))}};s.mockjax({url:"/worksheet/2014-05",contentType:"text/json",responseTime:100,responseText:{period:"May 2014",items:[{description:"Rent",type:"expense",budget:1600,actual:1600},{description:"Salary",type:"income",budget:5300,actual:4875},{description:"Groceries",type:"expense",budget:800,actual:650}]}});var c=(function(){var e={read:function(e,t){var a="/worksheet/"+e.id;s.ajax({url:a,dataType:"json"}).then(function(e){t.reply(e)})}};return t.subscribe({channel:"worksheet",topic:"#",callback:function(t,s){e.hasOwnProperty(s.topic)?e[s.topic](t,s):console.log("No such operation exists on the budget datasource:"+s.topic)}}),e}(),e.createClass({displayName:"Item",mixins:[i],onChange:function(e){var t=s(e.currentTarget),a=t.parent().hasClass("actual")?"actual":"budget",i={index:this.props.index,type:a,val:Number.parseFloat(t.val())};this.publish("item.change",i)},render:function(){return e.DOM.div({className:"row budget-item"},e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-6 desc"}," ",this.props.description),e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-3 budget"},e.DOM.input({type:"text",value:this.props.budget,onChange:this.onChange})),e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-3 actual"},e.DOM.input({type:"text",value:this.props.actual,onChange:this.onChange})))}})),n=e.createClass({displayName:"ItemAdd",mixins:[i],addItem:function(e){e.preventDefault();var t={description:s("#item_desc").val(),type:s("#item_type").val(),budget:Number.parseFloat(s("#item_budget").val()),actual:Number.parseFloat(s("#item_actual").val())};this.publish("item.add",t)},render:function(){return e.DOM.div({className:"budget-item-add"},e.DOM.div({className:"row budget-item"},e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-6 desc"},e.DOM.input({type:"text",id:"item_desc",placeholder:"description"})),e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-3"},e.DOM.input({type:"text",id:"item_budget",placeholder:"budget"})),e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-3"},e.DOM.input({type:"text",id:"item_actual",placeholder:"actual"}))),e.DOM.div({className:"row budget-item ctrls"},e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-6 desc"},e.DOM.select({id:"item_type"},e.DOM.option({value:"expense"},"Expense"),e.DOM.option({value:"income"},"Income"))),e.DOM.div({className:"col-xs-8 col-sm-8 col-md-8 col-lg-6"},e.DOM.button({name:"addItem",className:"btn btn-default",onClick:this.addItem},"Add"))))}}),o=e.createClass({displayName:"Summary",render:function(){return e.DOM.div({className:"summary "+this.props.type+" panel panel-default"},e.DOM.div({className:"row"},e.DOM.div({className:"col-xs-12 summary-header"},e.DOM.h3(null,this.props.type.charAt(0).toUpperCase()+this.props.type.slice(1)," ")),e.DOM.div({className:"panel-body"},e.DOM.div({className:"row"},e.DOM.div({className:"col-xs-6"},"Income:"),e.DOM.div({className:"col-xs-6 amount"},accounting.formatMoney(this.props.income))),e.DOM.div({className:"row"},e.DOM.div({className:"col-xs-6"},"Expense:"),e.DOM.div({className:"col-xs-6 amount"},accounting.formatMoney(this.props.expense))),e.DOM.div({className:"row remainder"},e.DOM.div({className:"col-xs-6"},"Remainder:"),e.DOM.div({className:"col-xs-6 amount"},accounting.formatMoney(this.props.remainder))))))}}),l=e.createClass({displayName:"Worksheet",getInitialState:function(){return{period:"",items:[],budgetExpense:function(){return this.items.reduce(function(e,t){return"expense"===t.type?e+t.budget:e},0)},budgetIncome:function(){return this.items.reduce(function(e,t){return"income"===t.type?e+t.budget:e},0)},budgetRemainder:function(){return this.budgetIncome()-this.budgetExpense()},actualExpense:function(){return this.items.reduce(function(e,t){return"expense"===t.type?e+t.actual:e},0)},actualIncome:function(){return this.items.reduce(function(e,t){return"income"===t.type?e+t.actual:e},0)},actualRemainder:function(){return this.actualIncome()-this.actualExpense()}}},mixins:[i,a],componentDidMount:function(){this.requestData(),this.subscribe("item.add",function(e){this.addNewItem(e)}),this.subscribe("item.change",function(e){this.updateItem(e.index,e.type,e.val)})},updateItem:function(e,t,s){var a=this.state.items.slice(0);a[e][t]=s,this.setState({items:a})},addNewItem:function(e){var t=this.state.items.concat([e]);this.setState({items:t})},render:function(){var t=this.props.namespace;return e.DOM.div({className:"container-fluid"},e.DOM.form(null,e.DOM.div({className:"row"},e.DOM.div({className:"col-xs-12 col-sm-12 col-md-12 col-lg-12 page-header worksheet-title"},e.DOM.h1(null,this.state.period))),e.DOM.div({className:"row"},e.DOM.div({className:"items col-xs-10 col-sm-6 col-md-4 col-lg-4"},e.DOM.div({className:"row budget-item"},e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-6 header"},"Description"),e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-3 header amount "},"Budget"),e.DOM.div({className:"col-xs-4 col-sm-4 col-md-4 col-lg-3 header amount"},"Actual")),this.state.items.map(function(e,s){return c({key:s,index:s,description:e.description,budget:e.budget,actual:e.actual,namespace:t})}),n({namespace:"worksheet"})),e.DOM.div({className:"col-xs-10 col-sm-3 col-md-3 col-lg-2"},o({type:"budget",income:this.state.budgetIncome(),expense:this.state.budgetExpense(),remainder:this.state.budgetRemainder()}),o({type:"actual",income:this.state.actualIncome(),expense:this.state.actualExpense(),remainder:this.state.actualRemainder()})))))}}),r=l({id:"2014-05",namespace:"worksheet"});e.renderComponent(r,document.body)}(React,postal,jQuery);